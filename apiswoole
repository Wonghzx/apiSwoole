#!/usr/bin/env php
<?php
////////////////////////////////////////////////////////////////////
//                          _ooOoo_                               //
//                         o8888888o                              //
//                         88" . "88                              //
//                         (| ^_^ |)                              //
//                         O\  =  /O                              //
//                      ____/`---'\____                           //
//                    .'  \\|     |//  `.                         //
//                   /  \\|||  :  |||//  \                        //
//                  /  _||||| -:- |||||-  \                       //
//                  |   | \\\  -  /// |   |                       //
//                  | \_|  ''\---/''  |   |                       //
//                  \  .-\__  `-`  ___/-. /                       //
//                ___`. .'  /--.--\  `. . ___                     //
//            \  \ `-.   \_ __\ /__ _/   .-` /  /                 //
//      ========`-.____`-.___\_____/___.-`____.-'========         //
//                           `=---='                              //
//      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^        //
//                           永无BUG                               //
////////////////////////////////////////////////////////////////////

$server = include_once 'Core/Core.php';
$server = \Core\Core::getInstance()->initialize();
/**
 *[commandParser 解释命令]
 * @author  Wongzx <[842687571@qq.com]>
 * @copyright Copyright (c)
 * @return    [type]        [description]
 */
function commandParser()
{
    global $argv; //$argv — 传递给脚本的参数数组
    $command = '';
    if (isset($argv[1])) {
        $command = $argv[1];
    }
    unset($argv[0]);
    $options = $argv;
    return [
        "command" => $command,
        "options" => $options
    ];
}

/**
 *[commandHandler 命令处理程序]
 * @author  Wongzx <[842687571@qq.com]>
 * @copyright Copyright (c)
 * @return    [type]        [description]
 */
function commandHandler()
{
    $comm = commandParser();
    switch ($comm['command']) {
        case 'start': //启动
            startServer();
            break;
        case 'stop': //停止
            break;
        case 'reload': //重装
            break;
        case 'update': //升级系统
            break;
        case 'version': //版本号
            echo "";
            break;
        case 'help': //帮助
        default: {
            help();
        }
    }
}

function startServer()
{
    echo lconLogo() . "\n";

}


function help()
{
    echo lconLogo() . "\n\n";
    echo "\033[36m ApiSwoole \033[0mversion \033[33m" . VERSION . " \033[0m" . date('Y-m-d H:i:s') . "\n\n";

    $helpString = <<<HELPSTRING
\033[32m start \033[0m          可启动服务
\033[32m stop \033[0m           可停止服务
\033[32m update \033[0m         可升级系统
\033[32m reload \033[0m         可重装服务
HELPSTRING;
    echo $helpString . "\n";


}

function lconLogo()
{
    $string = <<<STRING
   ___    _ __    _     ___                          _           
  /   \  | '_ \  (_)   / __| __ __ __ ___    ___    | |    ___   
  | - |  | .__/  | |   \__ \ \ V  V // _ \  / _ \   | |   / -_)  
  |_|_|  |_|__  _|_|_  |___/  \_/\_/ \___/  \___/  _|_|_  \___|  
_|"""""||"""""||"""""||"""""||"""""||"""""||"""""||"""""||"""""| 
"`-0-0-'"`-0-0-'"`-0-0-'"`-0-0-'"`-0-0-'"`-0-0-'"`-0-0-'"`-0-0-'"`-0-0-' 
STRING;

    return $string;
}

commandHandler();

